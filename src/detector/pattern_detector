import json
import requests

def generate_pattern(file, max_patterns) -> str:
    with open(file, 'r') as f:
        data = json.load(f)
        formatted_d = {key: value for key, value in data.items() if value.get("label") == "fraud"}
        
    TEMPLATE = """
    Dataset of transaction sequences and tax amounts:
    {seqs}

    Task:
    â€¢ Identify {max_patterns} number of general patterns found in the individual transactions.
    
    Format:
    Return the identified patterns in a semicolon-separated file (similar to a CSV) as shown in the example,
    with pattern_number and pattern_name columns:
    semicolon-separated file
    pattern_number;pattern_name
    1;pattern 1
    1;pattern 2
    3;pattern 3
    Only return the semicolon-separated list, no comments or explanation needed.
    """

    prompt = TEMPLATE.format(seqs=formatted_d, max_patterns=max_patterns)

    response = requests.post(
        'http://localhost:11434/api/generate',
        json={
            'model': 'llama3.2',
            'prompt': prompt,
            'stream': False
        }
    )
    return response.json().get('response', '')

        

print(generate_pattern("data/coev/coev_seq_v2.json", 5))
        